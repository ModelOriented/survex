<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Partial Dependence Explanations • survex</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- dalexverse --><link href="../dalexverse.css" rel="stylesheet">
<link href="../dalexverse-2.css" rel="stylesheet">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Partial Dependence Explanations">
<meta property="og:description" content="survex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-5650686-14"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-5650686-14');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">survex</a>
        <div class="info">
          <span class="partof">part of the <a href="https://github.com/ModelOriented/DrWhy" class="external-link">DrWhy.AI</a>
           developed by the <a href="https://mi2.ai/" class="external-link">MI².AI</a> </span>
          <span class="version version-default">1.2.0</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/mlr3proba-usage.html">How to use survex with mlr3proba</a>
    </li>
    <li>
      <a href="../articles/custom-explainers.html">Creating custom explainers</a>
    </li>
    <li>
      <a href="../articles/global-survshap.html">Global explanations with SurvSHAP(t)</a>
    </li>
    <li>
      <a href="../articles/pdp.html">Partial Dependence Explanations</a>
    </li>
    <li>
      <a href="../articles/survex-usage.html">Package usage</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ModelOriented/survex/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Partial Dependence Explanations</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ModelOriented/survex/blob/HEAD/vignettes/pdp.Rmd" class="external-link"><code>vignettes/pdp.Rmd</code></a></small>
      <div class="hidden name"><code>pdp.Rmd</code></div>

    </div>

    
    
<p>This vignette demonstrates how to use the Partial Dependence
explanations in <code>survex</code>, as well as Accumulated Local
Effects explanations. It especially demonstrates the usage of new kinds
of plots that are available in the 1.1 version of the package. To create
these explanations we follow the standard way of working with survex
i.e. we create a model, and an explainer.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://modeloriented.github.io/survex/">survex</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/imbs-hl/ranger" class="external-link">ranger</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vet</span> <span class="op">&lt;-</span> <span class="fu">survival</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survival/man/veteran.html" class="external-link">veteran</a></span></span>
<span></span>
<span><span class="va">rsf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ranger/man/ranger.html" class="external-link">ranger</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">vet</span><span class="op">)</span></span>
<span><span class="va">exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/explain_survival.html">explain</a></span><span class="op">(</span><span class="va">rsf</span>, data <span class="op">=</span> <span class="va">vet</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">vet</span><span class="op">$</span><span class="va">time</span>, <span class="va">vet</span><span class="op">$</span><span class="va">status</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Preparation of a new explainer is initiated </span></span>
<span><span class="co">#&gt;   -&gt; model label       :  ranger ( <span style="color: #BBBB00;"> default </span> ) </span></span>
<span><span class="co">#&gt;   -&gt; data              :  137  rows  6  cols </span></span>
<span><span class="co">#&gt;   -&gt; target variable   :  137  values ( 128 events and 9 censored ) </span></span>
<span><span class="co">#&gt;   -&gt; times             :  50 unique time points , min = 1.5 , median survival time = 80 , max = 999 </span></span>
<span><span class="co">#&gt;   -&gt; times             :  (  generated from y as uniformly distributed survival quantiles based on Kaplan-Meier estimator  ) </span></span>
<span><span class="co">#&gt;   -&gt; predict function  :  sum over the predict_cumulative_hazard_function will be used ( <span style="color: #BBBB00;"> default </span> ) </span></span>
<span><span class="co">#&gt;   -&gt; predict survival function  :  stepfun based on predict.ranger()$survival will be used ( <span style="color: #BBBB00;"> default </span> ) </span></span>
<span><span class="co">#&gt;   -&gt; predict cumulative hazard function  :  stepfun based on predict.ranger()$chf will be used ( <span style="color: #BBBB00;"> default </span> ) </span></span>
<span><span class="co">#&gt;   -&gt; model_info        :  package ranger , ver. 0.15.1 , task survival ( <span style="color: #BBBB00;"> default </span> ) </span></span>
<span><span class="co">#&gt;   A new explainer has been created!</span></span></code></pre></div>
<p>We use the explainer and the <code><a href="../reference/model_profile.surv_explainer.html">model_profile()</a></code> function to
calculate Partial Dependence explanations. We can specify the variables
for which we want to calculate the explanations. In this example we
calculate the explanations for the variables <code>karno</code> and
<code>celltype</code>. <strong>Note:</strong> The background for
generating PD values is the <code>data</code> field of the explainer! If
you want to calculate explanations with a background that is not the
training data, you need to manually specify the <code>data</code>
argument, when creating the explainer.</p>
<p>We can calculate Accumulated Local Effects in the same way, by
setting the <code>type</code> argument to
<code>"accumulated"</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pdp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_profile.surv_explainer.html">model_profile</a></span><span class="op">(</span><span class="va">exp</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"karno"</span>, <span class="st">"celltype"</span><span class="op">)</span>, N <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">ale</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_profile.surv_explainer.html">model_profile</a></span><span class="op">(</span><span class="va">exp</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"karno"</span>, <span class="st">"celltype"</span><span class="op">)</span>, N <span class="op">=</span> <span class="fl">20</span>, type <span class="op">=</span> <span class="st">"accumulated"</span><span class="op">)</span></span></code></pre></div>
<p>To plot these explanations you can use the plot function. By default
the explanations for all calculated variables are plotted. This example
demonstrates this for the <code>pdp</code> object which contains the
explanations for 2 variables.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pdp</span><span class="op">)</span></span></code></pre></div>
<p><img src="pdp_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>We can plot ALE explanations in the same way as PD explanations, as
is demonstrated by the example below. For the rest of the vignette we
only focus on PD explanations.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ale</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 6 rows containing missing values (`geom_line()`).</span></span></code></pre></div>
<p><img src="pdp_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>The <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function can also be used to plot the
explanations for a subset of variables. The <code>variables</code>
argument specifies the variables for which the explanations are plotted.
The <code>numerical_plot_type</code> argument specifies the type of plot
for numerical variables. For <code>numerical_plot_type = "lines"</code>
(default), the y-axis represents the mean prediction (survival
function), x-axis represents the time dimension, and different colors
represent values of the studied variable. For
<code>numerical_plot_type = "contours"</code>, the y-axis represents the
values of the studied variable, x-axis represents time, and different
colors represent the mean prediction (survival function).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pdp</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"karno"</span><span class="op">)</span>, numerical_plot_type <span class="op">=</span> <span class="st">"contours"</span><span class="op">)</span></span></code></pre></div>
<p><img src="pdp_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>The plots above make use of the time dependent output of survival
models, by placing the time dimension on the x-axis. However, for people
familiar with Partial Dependence explanations in classification and
regression, it might be more intuitive to place the variable values on
the x-axis. For this reason, we provide the
<code>geom = "variable"</code> argument, which can display the
explanations without the aspect of time.</p>
<p>To use this function a specific time of interest has to be chosen.
This time needs to be one of the values in the <code>times</code> field
of the explainer. For
<code>times_generation = "survival_quantiles"</code> (which is the
default when creating the explainer) the median survival time point is
also available. If the automatically generated times do not contain the
time of interest, one needs to manually specify the <code>times</code>
argument when creating the explainer.</p>
<p>The example below shows the PD explanations for the
<code>karno</code> variable at the median survival time. The y-axis
represents the mean prediction (survival function), x-axis represents
the values of the studied variable. Thin background lines are individual
ceteris paribus profiles (otherwise known as ICE profiles).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pdp</span>, geom <span class="op">=</span> <span class="st">"variable"</span>, variables <span class="op">=</span> <span class="st">"karno"</span>, times <span class="op">=</span> <span class="va">exp</span><span class="op">$</span><span class="va">median_survival_time</span><span class="op">)</span></span></code></pre></div>
<p><img src="pdp_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>The same plot can be generated for the categorical
<code>celltype</code> variable. In this case the x-axis represents the
different values of the studied variable, boxplots present the
distribution of individual ceteris paribus profiles, and the line
represents the mean prediction (survival function), which is the PD
explanation.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pdp</span>, geom <span class="op">=</span> <span class="st">"variable"</span>, variables <span class="op">=</span> <span class="st">"celltype"</span>, times <span class="op">=</span> <span class="va">exp</span><span class="op">$</span><span class="va">median_survival_time</span><span class="op">)</span></span></code></pre></div>
<p><img src="pdp_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Of course, the plots can be prepared for multiple time points, at the
same time and presented on one plot.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">selected_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">exp</span><span class="op">$</span><span class="va">times</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">exp</span><span class="op">$</span><span class="va">median_survival_time</span>, <span class="va">exp</span><span class="op">$</span><span class="va">times</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">exp</span><span class="op">$</span><span class="va">times</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">selected_times</span></span>
<span><span class="co">#&gt; [1]   1.5  80.0 999.0</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pdp</span>, geom <span class="op">=</span> <span class="st">"variable"</span>, variables <span class="op">=</span> <span class="st">"karno"</span>, times <span class="op">=</span> <span class="va">selected_times</span><span class="op">)</span></span></code></pre></div>
<p><img src="pdp_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pdp</span>, geom <span class="op">=</span> <span class="st">"variable"</span>, variables <span class="op">=</span> <span class="st">"celltype"</span>, times <span class="op">=</span> <span class="va">selected_times</span><span class="op">)</span></span></code></pre></div>
<p><img src="pdp_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p><code>survex</code> also implements 2 dimensional PD and ALE
explanations. These can be used to study the interaction between
variables. The <code><a href="../reference/model_profile_2d.surv_explainer.html">model_profile_2d()</a></code> function can be used to
calculate these explanations. The <code>variables</code> argument
specifies the variables for which the explanations are calculated. The
<code>type</code> argument specifies the type of explanation, and can be
set to <code>"partial"</code> (default) or
<code>"accumulated"</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pdp_2d</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_profile_2d.surv_explainer.html">model_profile_2d</a></span><span class="op">(</span><span class="va">exp</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"karno"</span>, <span class="st">"age"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pdp_2d_num_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_profile_2d.surv_explainer.html">model_profile_2d</a></span><span class="op">(</span><span class="va">exp</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"karno"</span>, <span class="st">"celltype"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>These explanations can be plotted using the plot function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pdp_2d</span>, times <span class="op">=</span> <span class="va">exp</span><span class="op">$</span><span class="va">median_survival_time</span><span class="op">)</span></span></code></pre></div>
<p><img src="pdp_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pdp_2d_num_cat</span>, times <span class="op">=</span> <span class="va">exp</span><span class="op">$</span><span class="va">median_survival_time</span><span class="op">)</span></span></code></pre></div>
<p><img src="pdp_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Mikołaj Spytek, Mateusz Krzyziński, Sophie Langbein, Hubert Baniecki, Przemyslaw Biecek.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
