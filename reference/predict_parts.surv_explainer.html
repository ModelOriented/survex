<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function decomposes the model prediction into individual parts, which are attributions of particular variables. The explanations can be made via the SurvLIME and SurvSHAP(t) methods."><title>Instance Level Parts of Survival Model Predictions — predict_parts • survex</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Instance Level Parts of Survival Model Predictions — predict_parts"><meta property="og:description" content="This function decomposes the model prediction into individual parts, which are attributions of particular variables. The explanations can be made via the SurvLIME and SurvSHAP(t) methods."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">survex</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/mlr3proba-usage.html">How to use survex with mlr3proba</a>
    <a class="dropdown-item" href="../articles/custom-explainers.html">Creating custom explainers</a>
    <a class="dropdown-item" href="../articles/survex-usage.html">Package usage</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ModelOriented/survex/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Instance Level Parts of Survival Model Predictions</h1>
      <small class="dont-index">Source: <a href="https://github.com/ModelOriented/survex/blob/HEAD/R/predict_parts.R" class="external-link"><code>R/predict_parts.R</code></a></small>
      <div class="d-none name"><code>predict_parts.surv_explainer.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function decomposes the model prediction into individual parts, which are attributions of particular variables. The explanations can be made via the SurvLIME and SurvSHAP(t) methods.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">predict_parts</span><span class="op">(</span><span class="va">explainer</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for surv_explainer</span></span>
<span><span class="fu">predict_parts</span><span class="op">(</span></span>
<span>  <span class="va">explainer</span>,</span>
<span>  <span class="va">new_observation</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  N <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"survshap"</span>,</span>
<span>  output_type <span class="op">=</span> <span class="st">"survival"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>explainer</dt>
<dd><p>an explainer object - model preprocessed by the <code><a href="explain_survival.html">explain()</a></code> function</p></dd>


<dt>...</dt>
<dd><p>other parameters which are passed to <code><a href="https://ModelOriented.github.io/iBreakDown/reference/break_down.html" class="external-link">iBreakDown::break_down</a></code> if <code>output_type=="risk"</code>, or if <code>output_type=="survival"</code> to <code><a href="surv_shap.html">surv_shap()</a></code> or <code><a href="surv_lime.html">surv_lime()</a></code> functions depending on the selected type</p></dd>


<dt>new_observation</dt>
<dd><p>a new observation for which prediction need to be explained</p></dd>


<dt>N</dt>
<dd><p>the maximum number of observations used for calculation of attributions. If <code>NULL</code> (default) all observations will be used.</p></dd>


<dt>type</dt>
<dd><p>if <code>output_type == "survival"</code> must be either <code>"survshap"</code> or <code>"survlime"</code>, otherwise refer to the <code><a href="https://modeloriented.github.io/DALEX/reference/predict_parts.html" class="external-link">DALEX::predict_parts</a></code></p></dd>


<dt>output_type</dt>
<dd><p>either <code>"survival"</code> or <code>"risk"</code> the type of survival model output that should be considered for explanations. If <code>"survival"</code> the explanations are based on the survival function. Otherwise the scalar risk predictions are used by the <code><a href="https://modeloriented.github.io/DALEX/reference/predict_parts.html" class="external-link">DALEX::predict_parts</a></code> function.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>An object of class <code>"predict_parts_survival"</code> and additional classes depending on the type of explanations. It is a list with the element <code>result</code> containing the results of the calculation.</p>
    </div>
    <div class="section level2">
    <h2 id="additional-parameters">Additional parameters<a class="anchor" aria-label="anchor" href="#additional-parameters"></a></h2>
    


<p>There are additional parameters that are passed to internal functions</p><ul><li><p>for <code>surv_lime</code></p><ul><li><p><code>N</code> -  a positive integer, number of observations generated in the neighbourhood</p></li>
<li><p><code>distance_metric</code> -  character, name of the distance metric to be used, only <code>"euclidean"</code> is implemented</p></li>
<li><p><code>kernel_width</code> -  a numeric, parameter used for calculating weights, by default it's <code>sqrt(ncol(data)*0.75)</code></p></li>
<li><p><code>sampling_method</code> -  character, name of the method of generating neighbourhood, only <code>"gaussian"</code> is implemented</p></li>
<li><p><code>sample_around_instance</code> -  logical, if the neighbourhood should be generated with the new observation as the center (default), or should the mean of the whole dataset be used as the center</p></li>
<li><p><code>max_iter</code> -  a numeric, maximal number of iteration for the optimization problem</p></li>
<li><p><code>categorical_variables</code> -  character vector, names of variables that should be treated as categories (factors are included by default)</p></li>
<li><p><code>k</code> -  a small positive number &gt; 1, added to chf before taking log, so that weigths aren't negative</p></li>
</ul></li>
<li><p>for <code>surv_shap</code></p><ul><li><p><code>timestamps</code> -  a numeric vector, time points at which the survival function will be evaluated</p></li>
<li><p><code>y_true</code> -  a two element numeric vector or matrix of one row and two columns, the first element being the true observed time and the second the status of the observation, used for plotting</p></li>
<li><p><code>calculation_method</code> -  a character, only <code>"kernel"</code> is implemented for now.</p></li>
<li><p><code>aggregation_method</code> -  a character, either <code>"mean_absolute"</code> or <code>"integral"</code>, <code>"max_absolute"</code>, <code>"sum_of_squares"</code></p></li>
</ul></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    

<ul><li><p>[1] Krzyziński, Mateusz, et al. <a href="https://arxiv.org/abs/2208.11080" class="external-link">"SurvSHAP(t): Time-dependent explanations of machine learning survival models."</a> arXiv preprint arXiv:2208.11080 (2022).</p></li>
<li><p>[2] Kovalev, Maxim S., et al. <a href="https://www.sciencedirect.com/science/article/pii/S0950705120304044?casa_token=6e9cyk_ji3AAAAAA:tbqo33MsZvNC9nrSGabZdLfPtZTsvsvZTHYQCM2aEhumLI5D46U7ovhr37EaYUhmKZrw45JzDhg" class="external-link">"SurvLIME: A method for explaining machine learning survival models."</a> Knowledge-Based Systems 203 (2020): 106164.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://modeloriented.github.io/survex/">survex</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">cph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">veteran</span>, model <span class="op">=</span> <span class="cn">TRUE</span>, x <span class="op">=</span> <span class="cn">TRUE</span>, y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cph_exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="explain_survival.html">explain</a></span><span class="op">(</span><span class="va">cph</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Preparation of a new explainer is initiated </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; model label       :  coxph ( <span style="color: #BBBB00;"> default </span> ) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; data              :  137  rows  6  cols ( <span style="color: #BBBB00;"> extracted from the model </span> ) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; target variable   :  137  values ( 128 events and 9 censored ) ( <span style="color: #BBBB00;"> extracted from the model </span> ) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; times             :  94 unique time points , min = 1 , mean = 119.9706 , max = 845.56 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; times             :  ( <span style="color: #BBBB00;"> generated from y with method quantiles </span> ) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; predict function  :  predict.coxph with type = 'risk' will be used ( <span style="color: #BBBB00;"> default </span> ) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; predict survival function  :  predictSurvProb.coxph will be used ( <span style="color: #BBBB00;"> default </span> ) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; predict cumulative hazard function  :  -log(predict_survival_function) will be used ( <span style="color: #BBBB00;"> default </span> ) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; model_info        :  package survival , ver. 3.4.0 , task survival ( <span style="color: #BBBB00;"> default </span> ) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  <span style="color: #00BB00;"> A new explainer has been created! </span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">cph_predict_parts_survshap</span> <span class="op">&lt;-</span> <span class="fu">predict_parts</span><span class="op">(</span><span class="va">cph_exp</span>, new_observation <span class="op">=</span> <span class="va">veteran</span><span class="op">[</span><span class="fl">1</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cph_predict_parts_survshap</span><span class="op">$</span><span class="va">result</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                trt    celltype       karno     diagtime          age</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t=1    0.001348230 0.005738131 0.002384769 3.802552e-06 0.0007609354</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t=1.36 0.001348230 0.005738131 0.002384769 3.802552e-06 0.0007609354</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t=2.72 0.002012258 0.008577731 0.003545841 5.671947e-06 0.0011383997</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t=4.24 0.003341661 0.014289563 0.005842108 9.406881e-06 0.0018993701</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t=7    0.005327253 0.022887981 0.009196888 1.496380e-05 0.0030488847</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t=8    0.007947563 0.034359457 0.013472284 2.225007e-05 0.0045890676</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               prior</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t=1    0.0001742598</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t=1.36 0.0001742598</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t=2.72 0.0002603235</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t=4.24 0.0004331010</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t=7    0.0006923584</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t=8    0.0010367437</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cph_predict_parts_survshap</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="predict_parts.surv_explainer-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">cph_predict_parts_survlime</span> <span class="op">&lt;-</span> <span class="fu">predict_parts</span><span class="op">(</span><span class="va">cph_exp</span>, new_observation <span class="op">=</span> <span class="va">veteran</span><span class="op">[</span><span class="fl">1</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                                            type <span class="op">=</span> <span class="st">"survlime"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cph_predict_parts_survlime</span><span class="op">$</span><span class="va">result</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           trt         karno      diagtime           age         prior </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.039141553  -0.002140917   0.001162822   0.001714308   0.002565933 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> celltypelarge </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  -0.041293577 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cph_predict_parts_survlime</span>, type <span class="op">=</span> <span class="st">"local_importance"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="predict_parts.surv_explainer-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Mikołaj Spytek, Mateusz Krzyziński, Hubert Baniecki, Przemyslaw Biecek.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

