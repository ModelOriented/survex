<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Instance Level Parts of Survival Model Predictions — predict_parts • survex</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- dalexverse --><link href="../dalexverse.css" rel="stylesheet"><link href="../dalexverse-2.css" rel="stylesheet"><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Instance Level Parts of Survival Model Predictions — predict_parts"><meta property="og:description" content="This function decomposes the model prediction into individual parts, which are attributions of particular variables. The explanations can be made via the SurvLIME and SurvSHAP(t) methods."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-5650686-14"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-5650686-14');
</script></head><body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">survex</a>
        <div class="info">
          <span class="partof">part of the <a href="https://github.com/ModelOriented/DrWhy" class="external-link">DrWhy.AI</a>
           developed by the <a href="https://mi2.ai/" class="external-link">MI².AI</a> </span>
          <span class="version version-default">1.1.0</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/mlr3proba-usage.html">How to use survex with mlr3proba</a>
    </li>
    <li>
      <a href="../articles/custom-explainers.html">Creating custom explainers</a>
    </li>
    <li>
      <a href="../articles/global-survshap.html">Global explanations with SurvSHAP(t)</a>
    </li>
    <li>
      <a href="../articles/pdp.html">Partial Dependence Explanations</a>
    </li>
    <li>
      <a href="../articles/survex-usage.html">Package usage</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ModelOriented/survex/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Instance Level Parts of Survival Model Predictions</h1>
    <small class="dont-index">Source: <a href="https://github.com/ModelOriented/survex/blob/HEAD/R/predict_parts.R" class="external-link"><code>R/predict_parts.R</code></a></small>
    <div class="hidden name"><code>predict_parts.surv_explainer.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function decomposes the model prediction into individual parts, which are attributions of particular variables. The explanations can be made via the SurvLIME and SurvSHAP(t) methods.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">predict_parts</span><span class="op">(</span><span class="va">explainer</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for surv_explainer</span></span>
<span><span class="fu">predict_parts</span><span class="op">(</span></span>
<span>  <span class="va">explainer</span>,</span>
<span>  <span class="va">new_observation</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  N <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"survshap"</span>,</span>
<span>  output_type <span class="op">=</span> <span class="st">"survival"</span>,</span>
<span>  explanation_label <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>explainer</dt>
<dd><p>an explainer object - model preprocessed by the <code><a href="explain_survival.html">explain()</a></code> function</p></dd>


<dt>...</dt>
<dd><p>other parameters which are passed to <code><a href="https://ModelOriented.github.io/iBreakDown/reference/break_down.html" class="external-link">iBreakDown::break_down</a></code> if <code>output_type=="risk"</code>, or if <code>output_type=="survival"</code> to <code><a href="surv_shap.html">surv_shap()</a></code> or <code><a href="surv_lime.html">surv_lime()</a></code> functions depending on the selected type</p></dd>


<dt>new_observation</dt>
<dd><p>a new observation for which prediction need to be explained</p></dd>


<dt>N</dt>
<dd><p>the maximum number of observations used for calculation of attributions. If <code>NULL</code> (default) all observations will be used.</p></dd>


<dt>type</dt>
<dd><p>if <code>output_type == "survival"</code> must be either <code>"survshap"</code> or <code>"survlime"</code>, otherwise refer to the <code><a href="https://modeloriented.github.io/DALEX/reference/predict_parts.html" class="external-link">DALEX::predict_parts</a></code></p></dd>


<dt>output_type</dt>
<dd><p>either <code>"survival"</code> or <code>"risk"</code> the type of survival model output that should be considered for explanations. If <code>"survival"</code> the explanations are based on the survival function. Otherwise the scalar risk predictions are used by the <code><a href="https://modeloriented.github.io/DALEX/reference/predict_parts.html" class="external-link">DALEX::predict_parts</a></code> function.</p></dd>


<dt>explanation_label</dt>
<dd><p>a label that can overwrite explainer label (useful for multiple explanations for the same explainer/model)</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>An object of class <code>"predict_parts_survival"</code> and additional classes depending on the type of explanations. It is a list with the element <code>result</code> containing the results of the calculation.</p>
    </div>
    <div id="additional-parameters">
    <h2>Additional parameters</h2>
    


<p>There are additional parameters that are passed to internal functions</p><ul><li><p>for <code>survlime</code></p><ul><li><p><code>N</code> -  a positive integer, number of observations generated in the neighbourhood</p></li>
<li><p><code>distance_metric</code> -  character, name of the distance metric to be used, only <code>"euclidean"</code> is implemented</p></li>
<li><p><code>kernel_width</code> -  a numeric, parameter used for calculating weights, by default it's <code>sqrt(ncol(data)*0.75)</code></p></li>
<li><p><code>sampling_method</code> -  character, name of the method of generating neighbourhood, only <code>"gaussian"</code> is implemented</p></li>
<li><p><code>sample_around_instance</code> -  logical, if the neighbourhood should be generated with the new observation as the center (default), or should the mean of the whole dataset be used as the center</p></li>
<li><p><code>max_iter</code> -  a numeric, maximal number of iteration for the optimization problem</p></li>
<li><p><code>categorical_variables</code> -  character vector, names of variables that should be treated as categories (factors are included by default)</p></li>
<li><p><code>k</code> -  a small positive number &gt; 1, added to chf before taking log, so that weigths aren't negative</p></li>
</ul></li>
<li><p>for <code>survshap</code></p><ul><li><p><code>timestamps</code> -  a numeric vector, time points at which the survival function will be evaluated</p></li>
<li><p><code>y_true</code> -  a two element numeric vector or matrix of one row and two columns, the first element being the true observed time and the second the status of the observation, used for plotting</p></li>
<li><p><code>calculation_method</code> -  a character, either <code>"kernelshap"</code> for use of <code>kernelshap</code> library (providing faster Kernel SHAP with refinements) or <code>"exact_kernel"</code> for exact Kernel SHAP estimation</p></li>
<li><p><code>aggregation_method</code> -  a character, either <code>"mean_absolute"</code> or <code>"integral"</code>, <code>"max_absolute"</code>, <code>"sum_of_squares"</code></p></li>
</ul></li>
</ul></div>
    <div id="references">
    <h2>References</h2>
    

<ul><li><p>[1] Krzyziński, Mateusz, et al. <a href="https://www.sciencedirect.com/science/article/pii/S0950705122013302" class="external-link">"SurvSHAP(t): Time-dependent explanations of machine learning survival models."</a> Knowledge-Based Systems 262 (2023): 110234</p></li>
<li><p>[2] Kovalev, Maxim S., et al. <a href="https://www.sciencedirect.com/science/article/pii/S0950705120304044?casa_token=6e9cyk_ji3AAAAAA:tbqo33MsZvNC9nrSGabZdLfPtZTsvsvZTHYQCM2aEhumLI5D46U7ovhr37EaYUhmKZrw45JzDhg" class="external-link">"SurvLIME: A method for explaining machine learning survival models."</a> Knowledge-Based Systems 203 (2020): 106164.</p></li>
</ul></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://modeloriented.github.io/survex/">survex</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">cph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">veteran</span>, model <span class="op">=</span> <span class="cn">TRUE</span>, x <span class="op">=</span> <span class="cn">TRUE</span>, y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cph_exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="explain_survival.html">explain</a></span><span class="op">(</span><span class="va">cph</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Preparation of a new explainer is initiated </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; model label       :  coxph ( <span style="color: #BBBB00;"> default </span> ) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; data              :  137  rows  6  cols ( <span style="color: #BBBB00;"> extracted from the model </span> ) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; target variable   :  137  values ( 128 events and 9 censored , censoring rate = 0.066 ) ( <span style="color: #BBBB00;"> extracted from the model </span> ) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; times             :  50 unique time points , min = 1.5 , median survival time = 80 , max = 999 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; times             :  ( <span style="color: #BBBB00;"> generated from y as uniformly distributed survival quantiles based on Kaplan-Meier estimator </span> ) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; predict function  :  predict.coxph with type = 'risk' will be used ( <span style="color: #BBBB00;"> default </span> ) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; predict survival function  :  predictSurvProb.coxph will be used ( <span style="color: #BBBB00;"> default </span> ) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; predict cumulative hazard function  :  -log(predict_survival_function) will be used ( <span style="color: #BBBB00;"> default </span> ) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; model_info        :  package survival , ver. 3.5.5 , task survival ( <span style="color: #BBBB00;"> default </span> ) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  <span style="color: #00BB00;"> A new explainer has been created! </span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">cph_predict_parts_survshap</span> <span class="op">&lt;-</span> <span class="fu">predict_parts</span><span class="op">(</span><span class="va">cph_exp</span>, new_observation <span class="op">=</span> <span class="va">veteran</span><span class="op">[</span><span class="fl">1</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cph_predict_parts_survshap</span><span class="op">$</span><span class="va">result</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               trt    celltype       karno      diagtime          age</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t=1.5 0.001358479 0.005752629 0.002400785 -1.753141e-05 0.0007519409</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t=4   0.003364680 0.014321361 0.005877960 -3.897254e-05 0.0018795538</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t=7   0.005360141 0.022931960 0.009247829 -5.480637e-05 0.0030211319</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t=8   0.007989085 0.034411531 0.013535810 -6.687523e-05 0.0045549833</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t=10  0.009277550 0.040094562 0.015567469 -6.898441e-05 0.0053188972</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t=12  0.011153127 0.048434497 0.018433696 -6.740775e-05 0.0064449115</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              prior</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t=1.5 0.0001596961</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t=4   0.0004003893</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t=7   0.0006457473</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t=8   0.0009784720</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t=10  0.0011456328</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t=12  0.0013939562</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cph_predict_parts_survshap</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="predict_parts.surv_explainer-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">cph_predict_parts_survlime</span> <span class="op">&lt;-</span> <span class="fu">predict_parts</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">cph_exp</span>,</span></span>
<span class="r-in"><span>    new_observation <span class="op">=</span> <span class="va">veteran</span><span class="op">[</span><span class="fl">1</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>    type <span class="op">=</span> <span class="st">"survlime"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cph_predict_parts_survlime</span><span class="op">$</span><span class="va">result</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          trt         karno      diagtime          age        prior</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 0.02474771 -0.0003756544 -0.0006072208 0.0002065337 0.0007857243</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   celltypelarge celltypesmallcell celltypesquamous</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   -0.03111269       -0.01907718      -0.02704715</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cph_predict_parts_survlime</span>, type <span class="op">=</span> <span class="st">"local_importance"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="predict_parts.surv_explainer-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Mikołaj Spytek, Mateusz Krzyziński, Sophie Langbein, Hubert Baniecki, Przemyslaw Biecek.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  </body></html>

